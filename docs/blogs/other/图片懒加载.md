---
title: 图片懒加载
date: 2023-05-23
tags:
 - other
categories:
 - other
---

## 图片懒加载

图片懒加载（lazy loading）是一种优化网站性能的技术，它可以将页面中的图片延迟加载，直到用户滚动到它们的位置时才加载。这意味着在页面初始加载时，只有用户可见区域内的图片会被加载，而其他图片则会等到需要显示时再进行加载。

使用图片懒加载可以提高网站的加载速度，因为它可以减少初始加载时需要下载的资源数量，从而使页面更快地呈现给用户。此外，它还可以降低网络流量的消耗，因为不会在访问页面时一次性下载所有的图片。

要实现图片懒加载，通常需要使用JavaScript来监测页面滚动事件，然后根据用户的滚动位置决定哪些图片需要被加载。常见的库包括`jQuery Lazy`和`Lozad.js`

## javascript实现代码

```js
/**
 * 方法一 监听滚动条 
 */
// 获取所有需要进行懒加载的图片元素
const lazyImages = document.querySelectorAll('.image');

// 判断元素是否在可见区域内
const isInViewport = (element) => {
  const rect = element.getBoundingClientRect();
  return rect.top <= window.innerHeight && rect.bottom >= 0
}

// 加载图片
const loadImg = () => {
  Array.from(lazyImages).forEach(img => {
    if (isInViewport(img)) {
      img.src = img.dataset.src
    }
  })
}

// 防抖
const debounce = (fn, delay = 0) => {
  let timer = null
  return () => {
    clearTimeout(timer)
    timer = setTimeout(() => {
      fn()
    }, delay)
  }
}

// 添加事件
window.addEventListener('scroll', debounce(loadImg, 500))

loadImg()

/**
 * 方法二 IntersectionObserver 实例 
 */

// 获取所有需要进行懒加载的图片元素
const lazyImages = document.querySelectorAll('.image');

// 创建 IntersectionObserver 实例
let ob = new IntersectionObserver(entires => {
  entires.forEach(val => {
    let Img = val.target
    // 将 data-src 属性替换为 src 属性
    // 判断方法一
    if (val.intersectionRatio > 0 && val.intersectionRatio <= 1) {
      Img.setAttribute('src', Img.getAttribute('data-src'))
      // 停止观察已经加载的图片
      ob.unobserve(Img)
    }
    // // 判断方法二
    // if (val.isIntersecting) {
    //     Img.src = Img.dataset.src
    //     // 停止观察已经加载的图片
    //     ob.unobserve(Img)
    // }
  })
})

// 开始观察每个需要懒加载的图片元素
Array.from(lazyImages).forEach(ele => ob.observe(ele))
```
