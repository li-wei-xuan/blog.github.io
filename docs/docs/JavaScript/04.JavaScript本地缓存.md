---
title: Javascript本地存储的方式
date: 2022-10-09
tags:
 - JavaScript
 - interview
categories:
 - JavaScript
 - interview
---
**在JavaScript 中，提供了四种可用的本地存储方式： cookie ，sessionStorage， localStorage， indexedDB。**

| 名称                              | 存储大小                                               | 有效时间                                                                       | 数据与服务器之间的交互方式                                       | 访问策略                     |
| --------------------------------- | ------------------------------------------------------ | ------------------------------------------------------------------------------ | ---------------------------------------------------------------- | ---------------------------- |
| [cookie](#cookie)                 | 数据大小不能超过4k                                     | 与设置的cookie过期时间有关，过期时间之前一直有效，即使窗口或浏览器关闭依然有效 | cookie的数据会自动的传递到服务器，服务器端也可以写cookie到客户端 | 符合同源策略可以访问         |
| [localStorage](#localstorage)     | 一般为 5M，大小根据厂商不同有所差异（2.5 ~ 10 M 波动） | 存储数据持久，浏览器关闭后数据不丢失除非主动删除数据，否则数据一直存在。       | 仅在本地保存，不与服务器交互                                     | 即使符合同源也不可以相互访问 |
| [sessionStorage](#sessionstorage) | 和 localStorage 一样                                   | 数据在当前浏览器窗口关闭后自动删除                                             | 仅在本地保存，不与服务器交互                                     | 符合同源策略可以访问         |
| [indexedDB](#indexeddb)           | 大于 250M                                              | 需手动更新 或 删除数据                                                         | 仅在本地保存，不与服务器交互                                     | 符合同源策略可以访问         |

## cookie
:::tip
1. cookie类型为「小型文本文件」，作为一段一般不超过 4KB 的小型文本数据。  
2. 它由名称（Name）、值（Value）和用于控制 cookie 有效期、安全性、使用范围 的可选属性组成，以键值对的形式存储到本地。  
3. cookie在每次请求中都会被发送，如果不使用 HTTPS 并对其加密，其保存的信息很容易被窃取，导致安全风险。
:::
### cookie的使用
```js
    //JavaScript 中，创建 cookie 如下所示：
    document.cookie = '名字=值';
    //cookie 添加一个过期时间（以 UTC 或 GMT 时间）。默认情况下，cookie 在浏览器关闭时删除：
    //使用 path 参数告诉浏览器 cookie 的路径。默认情况下，cookie 属于当前页面。
    document.cookie="username=John Doe; expires=Thu, 18 Dec 2043 12:00:00 GMT; path=/";
    // 读取 cookie：
    var x = document.cookie;
    // 修改 cookie 类似于创建 cookie，如下所示：
    document.cookie="username=John Smith; expires=Thu, 18 Dec 2043 12:00:00 GMT; path=/";
    // cookie的删除，最常用的方法就是给cookie设置一个过期的事件，这样cookie过期后会被浏览器删除
    document.cookie = "username=; expires=Thu, 01 Jan 1970 00:00:00 GMT";
```

## localStorage
:::tip
1. 生命周期：持久化的本地存储，除非主动删除数据，否则数据是永远不会过期的
2. 存储的信息在同一域中是共享的。
3. 当本页操作（新增、修改、删除）了 localStorage 的时候，本页面不会触发 storage 事件, 但是别的页面会触发 storage 事件。
4. 大小：5M（跟浏览器厂商有关系）
5. localStorage 本质上是对字符串的读取，如果存储内容多的话会消耗内存空间，会导致页面变卡
6. 受同源策略的限制
:::

### <font class="text-color-2" color="#e91e63">localStorage的缺点：</font>
```
无法像Cookie一样设置过期时间
只能存入字符串，无法直接存对象。可以借助 JSON.stringify() 存入， 配合 JSON.parse() 拿出解析。
```
### localStorage的使用

```javascript
    // 定义键值
    localStorage.setItem('username','zhangsan');
    // 获取键值
    localStorage.getItem('username')
    // 获取键名
    localStorage.key(0) //获取第一个键名
    // 删除键值
    localStorage.removeItem('username')
    // 一次性清除所有存储
    localStorage.clear()
```


## sessionStorage
:::tip
1. 生命周期：一旦页面（会话）关闭， sessionStorage 将会删除数据。
2. 存储的信息在同一域中是共享的。
3. 当本页操作（新增、修改、删除）了 sessionStorage 的时候，本页面不会触发 storage 事件, 但是别的页面会触发 storage 事件。
4. 大小：5M（跟浏览器厂商有关系）
5. sessionStorage 本质上是对字符串的读取，如果存储内容多的话会消耗内存空间，会导致页面变卡
6. 受同源策略的限制
:::
### <font class="text-color-2" color="#e91e63">sessionStorage的缺点：</font>
```
无法像Cookie一样设置过期时间
只能存入字符串，无法直接存对象。可以借助 JSON.stringify() 存入， 配合 JSON.parse() 拿出解析。
```

### sessionStorage的使用
```javascript
    // 定义键值
    sessionStorage.setItem('username','zhangsan');
    // 获取键值
    sessionStorage.getItem('username')
    // 获取键名
    sessionStorage.key(0) //获取第一个键名
    // 删除键值
    sessionStorage.removeItem('username')
    // 一次性清除所有存储
    sessionStorage.clear()
```

## indexedDB
:::tip
1. indexedDB 是一种低级API，用于客户端存储大量结构化数据(包括, 文件/ blobs)。该API 使用索引来实现对该数据的高性能搜索
2. 虽然 Web Storage 对于存储较少量的数据很有用，但对于存储更大量的结构化数据来说，这种方法不太有用。IndexedDB提供了一个解决方案
:::
### indexedDB的优点：
```
1. 储存量理论上没有上限
2. 所有操作都是异步的，相比 LocalStorage 同步操作性能更高，尤其是数据量较大时
3. 原生支持储存JS的对象
4. 是个正经的数据库，意味着数据库能干的事它都能干
```
### <font class="text-color-2" color="#e91e63">indexedDB的缺点：</font>
```
1. 操作非常繁琐
2. 本身有一定门槛
```
### 基本使用步骤：
```
1. 打开数据库并且开始一个事务
2. 创建一个 object store
3. 构建一个请求来执行一些数据库操作，像增加或提取数据等。
4. 通过监听正确类型的 DOM 事件以等待操作完成。
5. 在操作结果上进行一些操作（可以在 request 对象中找到）
```

## 应用场景
```
针对不对场景的使用选择不同的缓存方式：
* 标记用户与跟踪用户行为的情况，推荐使用 cookie
* 适合长期保存在本地的数据（令牌），推荐使用 localStorage
* 敏感账号一次性登录，推荐使用 sessionStorage
* 存储大量数据的情况、在线文档（富文本编辑器）保存编辑历史的情况，推荐使用indexedDB
```
